#lang mir
import "io"


def make_ring(n) = {
  if n == 0 {
    yarn {
      while true {
        reply(recv())
      }
    }
  } else {
    def next = make_ring(n-1)
    yarn {
      while true reply(send(next, recv()))
    }
  }
}


def dotest() = {
  def hoho = make_ring(1000)
  def i = 500
  while i > 0 {
    send(hoho, 0)
    i = i - 1
    io::Printf("~a\n", i)
  }
}

dotest()
